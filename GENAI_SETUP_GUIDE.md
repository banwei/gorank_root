# GenAI Item Enhancement Setup Guide

## Overview
The GenAI enhancement feature automatically enriches items in your ranking app with:
- **Engaging descriptions** generated by AI
- **High-quality images** automatically sourced and uploaded to Firebase Storage
- **Wikipedia links** for notable items
- **Official websites** for well-known brands/products
- **Smart categorization** and tagging

## Prerequisites
1. Google AI API Key (Gemini)
2. Firebase Storage configured
3. Backend server running

## Setup Instructions

### 1. Get Google AI API Key
1. Go to [Google AI Studio](https://aistudio.google.com/app/apikey)
2. Sign in with your Google account
3. Click "Create API Key"
4. Copy the generated API key

### 2. Configure Environment Variables
Add to your `backend/.env` file:
```bash
GOOGLE_AI_API_KEY=your-actual-api-key-here
```

### 3. Firebase Storage Setup
Ensure Firebase Storage is enabled in your Firebase project:
1. Go to Firebase Console > Storage
2. Click "Get started"
3. Set up security rules for public read access:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Allow public read access to uploaded images
    match /items/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null; // Only authenticated users can upload
    }
  }
}
```

## API Endpoints

### Single Item Enhancement
```bash
POST /api/items/{itemId}/enhance
```
Enhances a single item with AI-generated content.

### Batch Enhancement
```bash
POST /api/items/enhance-batch
{
  "itemIds": ["item1", "item2", "item3"],
  "category": "food" // optional
}
```
Enhances multiple items (max 20 per request).

## Usage Examples

### Enhance a Single Item
```bash
curl -X POST http://localhost:4001/api/items/abc123/enhance
```

### Enhance Multiple Items
```bash
curl -X POST http://localhost:4001/api/items/enhance-batch \
  -H "Content-Type: application/json" \
  -d '{
    "itemIds": ["item1", "item2", "item3"],
    "category": "technology"
  }'
```

### Get Popular Items (Enhanced)
```bash
curl http://localhost:4001/api/items/popular?limit=10
```

## Features

### ü§ñ AI-Generated Descriptions
- Uses Google's Gemini 1.5 Flash model
- Creates engaging 2-3 sentence descriptions
- Tailored to item category and context

### üñºÔ∏è Automatic Image Sourcing
- Intelligent image search queries generated by AI
- Downloads and uploads images to Firebase Storage
- Creates public URLs for immediate use
- Fallback to placeholder if no suitable image found

### üîó External Links
- **Wikipedia**: Automatically finds relevant Wikipedia articles
- **Official Websites**: Identifies official brand/product websites
- Links are validated before being added

### üè∑Ô∏è Smart Categorization
- AI analyzes and may refine item categories
- Adds relevant tags for better organization
- Consistent categorization across similar items

## Rate Limiting & Best Practices

### API Rate Limits
- **Single enhancement**: No specific limit
- **Batch enhancement**: Max 20 items per request
- **Auto-throttling**: 1-second delay between batch items

### Cost Optimization
- Items enhanced within 7 days are automatically skipped
- Efficient prompting to minimize API calls
- Image search optimized for quality over quantity

### Error Handling
- Graceful fallbacks for failed API calls
- Detailed error reporting in batch operations
- Automatic retry logic for transient failures

## Monitoring

### Success Tracking
Check the backend logs for enhancement progress:
```bash
[Items] Enhancing item: Pizza Margherita
[Items] Searching for image: margherita pizza authentic italian
[Items] Successfully enhanced item abc123 with GenAI data
```

### Common Issues
1. **GOOGLE_AI_API_KEY not configured**: GenAI features will be disabled
2. **Firebase Storage permissions**: Images may fail to upload
3. **API quota exceeded**: Enhancement will use fallback descriptions

## Frontend Integration

The enhanced items will automatically include:
```typescript
interface EnhancedItem {
  id: string;
  name: string;
  description: string; // AI-generated
  imageUrl?: string;   // Auto-sourced image
  category: string;    // AI-refined category
  tags?: string[];     // AI-generated tags
  wikipediaUrl?: string;
  officialWebsite?: string;
  enhancedAt?: string;
  enhancedBy?: string;
}
```

## Security Considerations

### API Key Security
- Never commit API keys to version control
- Use environment variables only
- Restrict API key permissions in Google Cloud Console

### Firebase Storage
- Configure appropriate security rules
- Monitor storage usage and costs
- Implement cleanup for unused images

### Input Validation
- All item names are sanitized before AI processing
- Image URLs are validated before download
- External links are checked for validity

## Testing

### Test Single Enhancement
```typescript
// Test with a simple item
const response = await fetch('/api/items/test-item/enhance', {
  method: 'POST'
});
const result = await response.json();
console.log(result.enhancement);
```

### Test Batch Enhancement
```typescript
const response = await fetch('/api/items/enhance-batch', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    itemIds: ['item1', 'item2'],
    category: 'food'
  })
});
const results = await response.json();
console.log(results.summary);
```

## Troubleshooting

### GenAI Not Working
1. Check if `GOOGLE_AI_API_KEY` is set correctly
2. Verify API key has proper permissions
3. Check Google AI Studio quotas

### Images Not Uploading
1. Verify Firebase Storage is enabled
2. Check storage security rules
3. Ensure Firebase credentials are configured

### Enhancement Skipped
- Items enhanced within 7 days are automatically skipped
- Check `enhancedAt` field in item data
- Use force refresh if needed (manual database update)

## Performance Tips

1. **Batch Processing**: Use batch endpoint for multiple items
2. **Category Filtering**: Specify category for better AI results
3. **Off-Peak Usage**: Run large batch jobs during off-peak hours
4. **Monitor Costs**: Track Google AI API usage

## Next Steps

After setup, you can:
1. Enhance existing items in bulk
2. Set up automatic enhancement for new items
3. Create admin interface for managing enhancements
4. Implement background job processing for large datasets
